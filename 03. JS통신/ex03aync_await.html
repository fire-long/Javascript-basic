<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <input type="date" id="date">
    <button id="btn">데이터 요청하기</button>
    <script>
        let btn = document.getElementById('btn');
        let date = document.getElementById('date');
        /*
            fetch 통신을 사용하는 방법(Promise) - async, await 키워드 사용하기
            (1) await
            : Promise 객체가 응답을 제대로 되돌려줄 때까지 기다리는(멈추는 키워드)
            : 반드시 async 함수 영역 안쪽에서만 사용 가능
            (2) async
            : 해당 영역 안쪽에서만 await 호출 가능
        */

        btn.addEventListener("click", async()=>{
            let url = 'http://www.kobis.or.kr/kobisopenapi/webservice/rest/boxoffice/searchDailyBoxOfficeList.json';
            let key = '?key={키 값}';       
            let targetDt = `&targetDt=${date.value.replaceAll('-', '')}`;
            const finalurl = url + key + targetDt;
            
            // try-catch-finally
            // try구문: 일단 한 번 시도해봐!
            try{
                const res = await fetch(finalurl);
                const data = await res.json();
                const movieList = data.boxOfficeResult.dailyBoxOfficeList;
                
                if (btn.nextElementSibling != null){
                    btn.nextElementSibling.remove();
                }

                let table = document.createElement("table");
                table.border = "1";
            
                movieList.forEach(e => {
                    let tr = document.createElement("tr");
                    let td1 = document.createElement('td');
                    let td2 = document.createElement('td');
                    td1.innerText = e.rank;
                    td2.innerText = e.movieNm;
                    tr.append(td1, td2);
                    
                    table.append(tr);
                });
                btn.after(table);
            } catch(err){
                //try 영역 안쪽에 있는 코드 block에서 error 발생 시
                //어떤 처리를 해줄지 작성해주는 영역
                console.log(err);
            } finally{
                //try 구문이 잘 실행되든, 
                //catch 구문으로 들어가든
                //반드시 한 번은 실행되는 영역
                // -> 자원 반납하는 코드를 많이 넣음!
            }
        })
    </script>
</body>
</html>