<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <button id="btn">정보요청하기</button>
    <script>
        /*
            JS 통신
            : Client(정보 요청하는 주체) - Server(정보 제공하는 주체)
              데이터를 주고 받는 과정을 통신이라고 한다.
            
            (1) 동기 통신
            : 요청이 들어왔을 때 HTML 문서 자체로 응답을 되돌려주는 방식
            : 화면이 새로고침이 발생하는 통신 방식(url이 변경)

            (2) 비동기 통신
            : 요청이 들어왔을 때 필요한 데이터만을 응답해주는 방식
            : 데이터를 받아와서 화면에 '처리'해주는 작업은 Client 쪽에서 진행
            : 화면에 새로고침이 발생되지 않는 통신 방식(url 변경 X)

            AJAX(Asynchrronous Javascript and XML)
            : 비동기통신을 부르는 또 다른 명칭

            JS 비동기통신을 구현할 수 있는 방법
            (1) fetch(): JS에서 기본적으로 제공해주는 함수
            (2) .ajax(): 별도의 라이브러리(jquery)가 필요함
            (3) axios(): 별도의 라이브러리(axios)가 필요함

        */


        let btn = document.getElementById('btn');
        btn.addEventListener("click", ()=>{
            //fetch 명령어(fetch == 가져오다)
            // -> GET 방식을 사용해서 요청 보냄!
            // GET방식이란?
            // : url 경로에 요청하고 싶은 데이터를 포함해서 보내는 형식
            // QueryString 방식: ~~~url?key1=value&key2=value2&key3=value3
            // 데이터를 무한대로 보낼 수는 없음. 브라우저마다 정해져 있는 게 있음.
            // 우리가 원하는 만큼은 보낼 수 있는 것!
            // url로 보낼 때는 제약이 있음(한글 인코딩, 띄어쓰기 기호 등)
            // POST방식
            // : 데이터를 숨겨서 보내는 형식


            //요청을 보낼 기본 url
            let url = 'http://www.kobis.or.kr/kobisopenapi/webservice/rest/boxoffice/searchDailyBoxOfficeList.json';
            //key 값 
            let key = '?key=490f85654295293a40c8336e13f89c02';
            //조회하고 싶은 일자
            let targetDt = '&targetDt=20260102';
            //최종 요청 url
            const finalurl = url + key + targetDt;

            /*
                fetch(요청url) -> Promise 객체(응답을 꼭 줄게!라는 약속 객체)
                    .then((res)=>{ -> Response(응답이 제대로 들어왔나? 정보를 지닌 객체)
                        return res.json(); -> 응답이라는 데이터 내부에 내가 필요한 '값'만 json 변환
                    })
                    .then((data)=>{ -> data 안에 json으로 변환한 값만 들어있는 형태
                        //화면에 작업하는 로직들을 작성하는 공간
                    })
                
                Promise 객체: 응답을 꼭 되돌려주리라 약속하는 객체 -> 상태 정보를 포함함!
                (1) pending: 응답 대기중
                (2) fullfilled: 응답이 되돌아올 시(충족) -> then
                (3) rejected: 문제상황 발생 시(거절) -> catch
            */
            fetch(finalurl)
                .then((res)=>
                    // 데이터 받으면 실행되는 콜백함수
                    res.json() //res.json을 로그 찍으면 Promise 객체 형태
                )
                .then((data)=>{ //data로 res.json()을 받아옴
                    //console.log(data.boxOfficeResult); //이제는 중괄호 형태!

                    // 랭킹 1위 영화제목만 뽑아서 콘솔에 출력
                    let movieList = data.boxOfficeResult.dailyBoxOfficeList;
                    console.log(movieList[0].movieNm);

                    // 버튼태그 아래쪽 h4태그를 생성해서, 영화제목 출력
                    let h4 = document.createElement("h4");
                    h4.innerText = movieList[0].movieNm
                    btn.after(h4);
                })
                .catch((err)=>{ //넣는 걸 "추천"
                    // 에러 발생했을 때 어떤 작업을 진행해줄 건지 작성하는 공간
                    console.log(err);
                })
        })

    </script>


</body>
</html>